const { ethers, upgrades } = require("hardhat");
const amoyDeployedData = require('../.openzeppelin/unknown-80002.json');

async function deployDepositV2() {
    try {
        const proxyArr = amoyDeployedData.proxies;
        const proxy = proxyArr[proxyArr.length - 1]; // WARNING - use with care, make sure the last proxy is the one you want use 
        const DepositV2 = await ethers.getContractFactory("Deposit_V2");
        console.log("Upgrading DepositV1 to DepositV2");
        console.log("Deploying DepositV2");
        const depositV2 = await upgrades.upgradeProxy(proxy.address, DepositV2, { initializer: '__Deposit_V2_init' });
        await depositV2.waitForDeployment();
        const address = await depositV2.getAddress();
        console.log("DepositV2 deployed to:", address);
    } catch (error) {
        console.error("Failed to upgrade DepositV1 to DepositV2 : ",error);
    }
}
deployDepositV2();