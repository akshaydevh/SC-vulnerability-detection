import { ethers } from "ethers";
import mailService from "@/service/mailer";
import config from "@/config";

const contractJSON = require('@/abi/Deposit_V1.json')
const provider = new ethers.InfuraWebSocketProvider(config.NETWORK, config.INFURA_API_KEY);
const contract = new ethers.Contract(config.CONTRACT_ADDRESS, contractJSON.abi, provider);

const watch = async () => {
    try {
        contract.on("withdwal", (withdrawer, amount, event) => {
            console.log(`new withdrawal from ${withdrawer} with amount ${amount} detected; Checking for Reentrancy......`)
            console.log(event)
            // check for Reentrancy
        })

        contract.on("reentrancy", (attacker, event) => {
            console.warn("ATTACK DETECTED: Reentrancy detected");
            console.log(event);
            console.log(`attacker: ${attacker}`);
        })
    } catch (error) {
        console.error("Error watching contract:", error);
    }
}

export default {
    watch
}